{"version":3,"sources":["../src/view.js"],"names":["init","cmid","ltiHostname","window","console","log","addEventListener","onMessage","bind","event","origin","URL","hostname","data","uuid","Ajax","call","methodname","args","fail","err","error","iframe","document","getElementById","parentNode","removeChild","Notification","alert","Str","get_string","then","modal","getRoot","on","ModalEvents","hidden","location","reload"],"mappings":"4eAAA,OACA,OACA,OACA,O,gmBAIoB,QAAPA,CAAAA,IAAO,CAACC,CAAD,CAAOC,CAAP,CAAuB,CACvCC,MAAM,CAACC,OAAP,CAAeC,GAAf,kEACAF,MAAM,CAACG,gBAAP,CAAwB,SAAxB,CAAmCC,CAAS,CAACC,IAAV,QAAqBP,CAArB,CAA2BC,CAA3B,CAAnC,CACH,C,CAED,QAASK,CAAAA,CAAT,CAAmBN,CAAnB,CAAyBC,CAAzB,CAAsCO,CAAtC,CAA6C,CACzC,GAAMC,CAAAA,CAAM,CAAG,GAAIC,CAAAA,GAAJ,CAAQF,CAAK,CAACC,MAAd,EAAsBE,QAArC,CAEA,GAAIF,CAAM,EAAIR,CAAd,CAA2B,CACvBC,MAAM,CAACC,OAAP,CAAeC,GAAf,+DAAsDI,CAAK,CAACC,MAA5D,2BAAoFR,CAApF,gBACA,MACH,CAEDC,MAAM,CAACC,OAAP,CAAeC,GAAf,sDAA6CI,CAAK,CAACI,IAAN,CAAWC,IAAxD,sBAAyEb,CAAzE,GAEAc,UAAKC,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,yBADL,CAEPC,IAAI,CAAE,CAACjB,IAAI,CAAEA,CAAP,CAAaa,IAAI,CAAEL,CAAK,CAACI,IAAN,CAAWC,IAA9B,CAFC,CAGPK,IAAI,CAAE,cAACC,CAAD,CAAS,CACXjB,MAAM,CAACC,OAAP,CAAeiB,KAAf,CAAqBD,CAArB,EAGA,GAAME,CAAAA,CAAM,CAAGC,QAAQ,CAACC,cAAT,CAAwB,kBAAxB,CAAf,CACAF,CAAM,CAACG,UAAP,CAAkBC,WAAlB,CAA8BJ,CAA9B,EAGAK,UAAaC,KAAb,CACIC,CAAG,CAACC,UAAJ,CAAe,mBAAf,CAAoC,YAApC,CADJ,CAEID,CAAG,CAACC,UAAJ,CAAe,qBAAf,CAAsC,YAAtC,CAFJ,CAGID,CAAG,CAACC,UAAJ,CAAe,oBAAf,CAAqC,YAArC,CAHJ,EAIKC,IAJL,CAIU,SAAUC,CAAV,CAAiB,CACnBA,CAAK,CAACC,OAAN,GAAgBC,EAAhB,CAAmBC,UAAYC,MAA/B,CAAuC,UAAY,CAC/CjC,MAAM,CAACkC,QAAP,CAAgBC,MAAhB,IACH,CAFD,CAGH,CARL,CASH,CApBM,CAAD,CAAV,CAsBH,C","sourcesContent":["import * as Str from 'core/str';\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport ModalEvents from 'core/modal_events';\n\nconst PREFIX = 'mod_daddyvideo:';\n\nexport const init = (cmid, ltiHostname) => {\n    window.console.log(`${PREFIX} Registering message listener...`);\n    window.addEventListener('message', onMessage.bind(this, cmid, ltiHostname));\n};\n\nfunction onMessage(cmid, ltiHostname, event) {\n    const origin = new URL(event.origin).hostname;\n\n    if (origin != ltiHostname) {\n        window.console.log(`${PREFIX} Received message from ${event.origin} but expecting ${ltiHostname}, ignoring`);\n        return;\n    }\n\n    window.console.log(`${PREFIX} Setting UUID ${event.data.uuid} for cmid ${cmid}`);\n\n    Ajax.call([{\n        methodname: \"mod_daddyvideo_set_uuid\",\n        args: {cmid: cmid, uuid: event.data.uuid},\n        fail: (err) => {\n            window.console.error(err);\n\n            // Remove iframe to stop upload\n            const iframe = document.getElementById('daddyvideo-embed');\n            iframe.parentNode.removeChild(iframe);\n\n            // Alert the user and refresh on dismiss\n            Notification.alert(\n                Str.get_string('error_popup_title', 'daddyvideo'),\n                Str.get_string('error_popup_message', 'daddyvideo'),\n                Str.get_string('error_popup_button', 'daddyvideo'))\n                .then(function (modal) {\n                    modal.getRoot().on(ModalEvents.hidden, function () {\n                        window.location.reload(true);\n                    });\n                });\n        }\n    }]);\n}\n"],"file":"view.min.js"}